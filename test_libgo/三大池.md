# c++ 三大池学习
连接池和线程池大部分用单例模式设计，内存池通常用线程内部内存池设计
## 连接池
预先创建并维护一批可复用的网络连接 / 数据库连接（如 TCP 连接、MySQL/Redis 连接），避免每次请求都重新建立 / 关闭连接（连接的建立 / 断开往往涉及三次握手、认证等高频耗操作）。
*** 设计要点 ***
1. 池化管理：维护空闲连接队列和已用连接队列
2. 回收机制：超时/idel连接自动销毁，避免资源泄漏
3. 连接数不足时自动创建新连接（不超过上限）
4. 线程安全：多线程取 / 还连接时需加锁（如互斥锁 + 条件变量）
*** epoll和连接池的关系 ***
1. 连接池的主要作用是复用连接，epoll则是对I/O事件的监听
2. 创建的连接会注册到epoll里，每个连接都会被监听，被销毁是停止监听
3. epoll流程：内核态处理（事件触发→加入就绪链表→唤醒线程）用户态处理（读取事件→处理业务→循环等待）
## 线程池
线程池是用户态管理的、复用工作线程的核心组件，核心目标是避免频繁创建 / 销毁线程的开销，控制总线程数以规避 CPU 上下文切换过载
*** 设计要点 ***
1. 复用线程：线程创建 / 销毁涉及内核态切换，复用线程可省掉这部分开销
2. 使用空闲线程：任务不需要新建线程，使用空闲线程
3. 条件变量：共享资源，非线程所有
## 内存池
内存池的核心目标是 “减少内存碎片、提升分配效率”
*** 设计要点 ***
1. 线程内部内存池，自己用自己的内存
2. 操作系统只用首次分配连续内存块，后续从池内划分，不需要频繁释放块
3. 内存池具有较高实时性，不依赖操作系统调度

